# سیستم فیلوور DNS آروان

این اسکریپت برای مدیریت خودکار DNS فیلوور از طریق ArvanCloud API طراحی شده است. این اسکریپت به طور مداوم وضعیت سرورها را بررسی می‌کند و در صورت قطعی سرور اصلی، به طور خودکار ترافیک را به سرور پشتیبان منتقل می‌کند.

## ویژگی‌ها

- مانیتورینگ مداوم سرورها با پینگ
- سوئیچ خودکار به سرور پشتیبان در صورت قطعی سرور اصلی
- اطلاع‌رسانی از طریق تلگرام با قابلیت میوت/آنمیوت
- همگام‌سازی تنظیمات xray بین سرورها
- بررسی انقضای گواهینامه SSL
- همگام‌سازی فولدر گواهینامه‌ها بین سرورها
- مانیتورینگ تعداد کلاینت‌ها با منطق retry خودکار
- قابلیت restart کردن سرویس panel
- انواع مختلف هشدار برای مشکلات مختلف (ظرفیت، فیلوور، SSL، panel)

## پیش‌نیازها

- Python 3.x
- دسترسی به ArvanCloud API
- دسترسی SSH به سرورها
- ربات تلگرام برای اطلاع‌رسانی

## نصب

1. نصب پکیج‌های مورد نیاز:
```bash
pip install -r requirements.txt
```

2. تنظیم فایل کانفیگ:
   - کپی کردن فایل `dns-arvan.py`
   - تنظیم مقادیر در بخش `CONFIG`

## تنظیمات

در بخش `CONFIG` فایل اصلی، موارد زیر را تنظیم کنید:

- `apikey`: کلید API آروان
- `domain`: دامنه اصلی
- `telegram_bot_token`: توکن ربات تلگرام
- `telegram_chat_id`: شناسه چت تلگرام
- تنظیمات مربوط به هر ساب‌دامین در بخش `records`

## نحوه استفاده

اسکریپت را می‌توان به صورت دستی یا از طریق cron اجرا کرد:

```bash
python dns-arvan.py
```

## وضعیت‌ها

اطلاعات وضعیت در فایل `state.json` ذخیره می‌شود که شامل:
- وضعیت فعلی هر دامنه (در حالت پشتیبان یا عادی)
- IP‌های اصلی برای بازگشت
- زمان آخرین بررسی گواهینامه‌ها
- تنظیمات میوت برای انواع مختلف هشدار (ظرفیت، فیلوور، SSL، panel)

## انواع هشدار

سیستم از انواع مختلف هشدار با کنترل‌های میوت جداگانه پشتیبانی می‌کند:
- **هشدارهای ظرفیت**: زمانی که تعداد کلاینت‌ها از حد مجاز بیشتر شود
- **هشدارهای فیلوور**: زمانی که DNS فیلوور فعال/بازگردانی شود
- **هشدارهای SSL**: زمانی که گواهینامه‌های SSL به زودی منقضی شوند
- **هشدارهای Panel**: زمانی که سرویس x-ui panel مشکل داشته باشد
